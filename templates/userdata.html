<!DOCTYPE html>
<html>

<head>
	<meta name="viewport" content="width=device-width, initial-scale=1">
  	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
  	<script src="https://cdn.jsdelivr.net/npm/sweetalert2@8"></script>
  	<script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
  	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
  	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
	
	<style >
		input{
  			margin-top:10px;
  			margin-right:10px; 
  			margin-bottom: 10px;
  		}
  		#button1{
  			margin-right:  150px;
  		}
  		table{
  			text-align: center;
  			margin-top:20px;
  			margin-left:70px;
  		}
  		.btn1
  		{
  			margin-left:  900px;
  			margin-top:40px;
  		}
  		

  	</style>
</head>

<body>
<script type="text/javascript">
 				function validateForm() { 
					var fname=$("#first_name").val();
					var lname=$("#last_name").val();
					var email=$("#email").val();
					var phone=$("#phone").val();
					var about=$("#about").val();
					
					
					if (fname==null || fname==""){ 

						alert("FirstName can't be blank");
						$('#first_name').css({"border-color": "red"}).focus();
						return false;  
    				}
    				else if(lname==null || lname==""){
    					alert("LastName can't be blank");  
    					$('#last_name').css({"border-color": "red"}).focus();
    					return false;  
    				}
    			    else if(email==null||email==""){
    					alert("Email Address can't be blank");
    					$('#email').css({"border-color": "red"}).focus();
						return false;
					}
					else if(email.indexOf('@')<=0){
						alert("Enter Valid Email Address @");
						$('#email').css({"border-color": "red"}).focus();
						return false;
					}
					else if(email.charAt(email.length-4)!='.' && email.charAt(email.length-3)!='.'){
						alert("Enter Valid Email Address .");
						$('#email').css({"border-color": "red"}).focus();
						return false;
					}
					else if(phone==null||phone==""){
						alert("Mobile number can't be blank");  
						$('#phone').css({"border-color": "red"}).focus();
    					return false;
    				}
    				else if(isNaN(phone)){
						alert("Enter valid Mobile number");  
						$('#phone').css({"border-color": "red"}).focus();
    					return false;
    				}
    				else if(phone.length<10){
    					alert("Enter valid Mobile number");  
    					$('#phone').css({"border-color": "red"}).focus();
    					return false;
    				}
    				
        			else{ 
        				var data = {
        					'first_name':fname,
		                    'last_name': lname,
		                    'email':email,
		                    'phone':phone,
		                    'about':about,
                    
                    		}
                    	console.log(data);
        			 	$.ajax({
						  	type : 'POST',
						  	url : "{{url_for('userinsert')}}",
						   	contentType: 'application/json',
					        dataType : 'json',
					        data: JSON.stringify(data),
					        success : function(data)
					        { 
					         	Swal.fire({
										text: data.result,
									});
					         	location.reload(true);
					         } 

					         });
				}
			}
function dynamicid( i)
{
	var  id1=document.getElementById('id-'+ i).value;
	console.log(id1);
	validateFormupdate(id1);

}


function validateFormupdate(id1) { 
					var id2=$("#id-"+id1).val();
					var fname=$("#first_name-"+id1).val();
					var lname=$("#last_name-"+id1).val();
					var email=$("#email-"+id1).val();
					var phone=$("#phone-"+id1).val();
					var about=$("#about-"+id1).val();
										
					
					console.log(id2);
					console.log(fname);
					console.log(lname);
					console.log(email);
					console.log(phone);
					console.log(about);
					

					if (fname==null || fname==""){ 
						alert("FirstName can't be blank"); 
						$("#first_name-"+id1).css({"border-color": "red"}).focus();
    					return false;  
    				}
    				else if(lname==null || lname==""){
    					alert("LastName can't be blank"); 
    					$("#last_name-"+id1).css({"border-color": "red"}).focus(); 
    					return false;  
    				}
    			    else if(email==null||email==""){
    					alert("Email Address can't be blank");
    					$("#email-"+id1).css({"border-color": "red"}).focus();
						return false;
					}
					else if(email.indexOf('@')<=0){
						alert("Enter Valid Email Address @");
						$("#email-"+id1).css({"border-color": "red"}).focus();
						return false;
					}
					else if(email.charAt(email.length-4)!='.' && email.charAt(email.length-3)!='.'){
						alert("Enter Valid Email Address .");
						$("#phone-"+id1).css({"border-color": "red"}).focus();
						return false;
					}
					else if(phone==null||phone==""){
						alert("Mobile number can't be blank");  
						$("#phone-"+id1).css({"border-color": "red"}).focus();
    					return false;
    				}
    				else if(isNaN(phone)){
						alert("Enter valid Mobile number");  
						$("#phone-"+id1).css({"border-color": "red"}).focus();
    					return false;
    				}
    				else if(phone.length<10){
    					alert("Enter valid Mobile number");  
    					$("#phone-"+id1).css({"border-color": "red"}).focus();
    					return false;
    				}
    				else{ 
        	

            var data = {
            		'id':id2,
                    'first_name':fname,
                    'last_name': lname,
                    'email':email,
                    'phone':phone,
                    'about':about,
                                       
                    }
                    console.log(data);
        			 $.ajax({
						  type : 'POST',
						  url : "{{url_for('userupdate')}}",
						   contentType: 'application/json',
					         dataType : 'json',
					         data: JSON.stringify(data),
					         success : function(data)
					         { 
					         	Swal.fire({
										text: data.result,
									});
					         	location.reload(true);
 
					         }  

					         });
					     		  
       			}
       		}

</script>

	

<div class="container">
		<h1>User Validation</h1>
		<div class="btn1">
		 <button id="button2" type="button" class="btn btn-primary btn-margin-left" data-toggle="modal" data-target="#myModal">Add User
		 </button> 
		 <a href="{{url_for('adminlogout')}}">
		 <button class="btn btn-primary btn-margin-left" >Logout
		 </button></a>
		</div>
	

<div class="modal" id="myModal">
 
<h1><center>CRUD Application</center></h1>
<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<h4 class="modal-title">Add Information</h4>
						<button type="button" class="close " data-dismiss="modal">&times;</button>
					</div>
					<div class="modal-body">
						
							<label>First Name:</label>
							<input type="text" class="form-control" id="first_name"  pattern="[A-Za-z]+" >

							<label>Last Name:</label>
							<input type="text" class="form-control" id="last_name" pattern="[A-Za-z]+" >

							<label>Email:</label>
							<input type="text" class="form-control" id="email" >

					    	<label>Phone:</label>
							<input type="text" class="form-control" maxlength="10" id="phone" >

							<label>About:</label>
							<input type="text"  class="form-control" id="about" >

							<button class="btn btn-primary" name='submit' id="submit1" onclick="return validateForm()">Submit</button>
						
					</div>
				</div>
			</div>

	</div>

	


<table class="table ">
	<thead>
	
		<th>Id</th>
		<th>First Name</th>
		<th>Last Name</th>
		<th>Email</th>
		<th>Phone</th>
		<th>About</th>
		<th>Action</th>
		
			
	</thead>
		<tbody>
			<tr>

			{% for row in user%}
			<td>{{row.user_id}}</td>
			<td>{{row.fname}}</td>
			<td>{{row.lname}}</td>
			<td>{{row.email}}</td>
			<td>{{row.mobileno}}</td>
			<td>{{row.about}}</td>
			<td>
			
				<a href="#" class="btn btn-warning btn-xs" data-toggle="modal" data-target="#modaledit{{row.user_id}}">Edit</a>
                <a href="/userdelete/{{row.user_id}}" class="btn btn-danger btn-xs" onclick="return confirm('Are You Sure For Delete?')">Delete</a>
            </td>

			</tr>
		
		<div id="modaledit{{row.user_id}}" class="modal fade" role="dialog">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<h4 class="modal-title">Update Information</h4>
						<button type="button" class="close" data-dismiss="modal">&times;</button>
						
					</div>
					<div class="modal-body">
							
							<label>First Name:</label>
							<input type="hidden"  id="id-{{row.user_id}}" value="{{row.user_id}}">
							<input type="text" class="form-control" id="first_name-{{row.user_id}}" pattern="[A-Za-z]+"  value="{{row.fname}}" >

							<label>Last Name:</label>
		
							<input type="text" class="form-control" id="last_name-{{row.user_id}}" value="{{row.lname}}" pattern="[A-Za-z]+" >

							<label>Email:</label>
							<input type="email" class="form-control" id="email-{{row.user_id}}" value="{{row.email}}" >

							<label>Phone:</label>
							<input type="text" class="form-control" maxlength="10" id="phone-{{row.user_id}}" value="{{row.mobileno}}">

							<label>About:</label>
							<input type="text"  class="form-control" id="about-{{row.user_id}}" value="{{row.about}}">

							<button class="btn btn-primary" type="sbumit" id="update1" onclick="return dynamicid('{{row.user_id}}')">Update</button>
						
					</div>
				</div>
			</div>
			
		</div><br>

               {% endfor  %}
</tbody>
</table>

</body>
</html>